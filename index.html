<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Scanner with Cloudmersive Integration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
    <h1>Barcode Scanner and Product Lookup</h1>
    <!-- Camera Feed -->
    <video id="video" autoplay style="width: 100%; max-width: 500px; border: 2px solid #000;"></video>
    <p id="scannedData" style="font-weight: bold;"></p>
    <button onclick="startBarcodeScanner()">Start Scanning</button>

    <script>
        // Variables
        let currentFacingMode = 'environment'; // Default to rear camera
        const videoElement = document.getElementById('video');

        // Start camera
        function startCamera(facingMode) {
            navigator.mediaDevices.getUserMedia({
                video: { facingMode: facingMode }
            })
            .then(stream => {
                videoElement.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing camera:", err);
                alert("Could not access the camera.");
            });
        }

        startCamera(currentFacingMode);

        // Start barcode scanner using Quagga
        function startBarcodeScanner() {
            Quagga.init({
                inputStream: {
                    type: "LiveStream",
                    target: videoElement,
                    constraints: { facingMode: currentFacingMode }
                },
                decoder: {
                    readers: ["upc_reader", "ean_reader"] // Specify barcode types
                }
            }, err => {
                if (err) {
                    console.error("Error initializing scanner:", err);
                    alert("Failed to start barcode scanner.");
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected(data => {
                const scannedCode = data.codeResult.code; // Get the scanned data
                document.getElementById("scannedData").innerText = `Scanned Code: ${scannedCode}`;
                console.log("Scanned Code:", scannedCode);

                // Call Cloudmersive API with the scanned code
                lookupProduct(scannedCode);
                Quagga.stop();
            });
        }

